<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>French Vocabulary Trainer</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
            --background-color: #f5f5f5;
            --text-color: #333;
            --card-background: #fff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            background: var(--card-background);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        label {
            font-weight: 600;
        }

        input[type="number"],
        input[type="text"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            background-color: var(--primary-color);
            color: white;
        }

        button:hover {
            opacity: 0.9;
        }

        button:active {
            transform: translateY(1px);
        }

        #playButton {
            background-color: var(--primary-color);
        }

        #showButton {
            background-color: var(--secondary-color);
        }

        #testButton {
            background-color: #ff9800;
        }

        .options {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #wordDisplay {
            background: var(--card-background);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .word-card {
            background: var(--card-background);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .word-french {
            font-size: 1.5em;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .word-hebrew {
            font-size: 1.2em;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }

        .word-example {
            font-style: italic;
            color: #666;
        }

        .word-id {
            font-size: 12px;
            color: #999;
            background-color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            display: inline-block;
            margin-bottom: 5px;
        }

        .audio-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .controls {
                grid-template-columns: 1fr;
                padding: 15px;
            }

            .buttons {
                flex-direction: column;
            }

            button {
                width: 100%;
                padding: 15px; /* Larger touch targets */
            }

            .options {
                flex-direction: column;
                align-items: stretch;
            }

            .audio-controls {
                flex-direction: column;
                gap: 15px;
            }

            input[type="range"] {
                width: 100%;
                height: 30px; /* Larger touch target */
            }

            input[type="number"],
            input[type="text"] {
                padding: 12px;
                font-size: 16px; /* Prevents zoom on iOS */
            }

            .word-card {
                padding: 15px;
            }

            .keyboard-shortcuts {
                display: none; /* Hide keyboard shortcuts on mobile */
            }
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #ddd;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }

        .keyboard-shortcuts {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">

    <h1>French Vocabulary Trainer</h1>

    <div class="controls">
        <div class="control-group">
            <label for="start">Start Index:</label>
            <input type="number" id="start" min="0" max="49" value="0">
        </div>

        <div class="control-group">
            <label for="end">End Index:</label>
            <input type="number" id="end" min="1" max="49" value="9">
        </div>

        <div class="control-group">
            <label for="pattern">Pattern:</label>
            <input type="text" id="pattern" value="eeh" placeholder="e=French, h=Hebrew, s=Sentence">
        </div>
    </div>

    <div class="options">
        <div class="checkbox-group">
            <label for="shuffle">Shuffle Words:</label>
            <input type="checkbox" id="shuffle" name="shuffle" checked>
        </div>

        <div class="audio-controls">
            <div class="speed-control">
                <label for="speed">Speech Speed:</label>
                <input type="range" id="speed" min="0.5" max="2" step="0.1" value="1">
                <span id="speedValue">1x</span>
            </div>
            <div class="volume-control">
                <label for="volume">Volume:</label>
                <input type="range" id="volume" min="0" max="1" step="0.1" value="1">
            </div>
        </div>
    </div>

    <div class="buttons">
        <button id="playButton">Play</button>
        <button id="pauseButton">Pause</button>
        <button id="showButton">Show</button>
        <button id="testButton">Test</button>
        <button id="searchButton">Search</button>
    </div>

    <div class="progress-bar">
        <div class="progress" id="progress"></div>
    </div>

    <div id="wordDisplay"></div>

    <div class="keyboard-shortcuts">
        Shortcuts: Space = Play/Pause, ← → = Navigate, ↑ ↓ = Volume
    </div>


    <script>
        let currentWordIndex = 0;
        let isPlaying = false;
        let speechRate = 1;
        let volume = 1;
// אוצר מילים מקטגוריות שונות ללימוד
        const vocabulary = [
            { french: "bonjour", hebrew: "שלום/בוקר טוב", example: "Bonjour, comment allez-vous aujourd'hui?" },
            { french: "merci", hebrew: "תודה", example: "Merci beaucoup pour votre aide." },
            { french: "au revoir", hebrew: "להתראות", example: "Au revoir, à bientôt!" },
            { french: "s'il vous plaît", hebrew: "בבקשה", example: "S'il vous plaît, pouvez-vous m'aider?" },
            { french: "excusez-moi", hebrew: "סליחה", example: "Excusez-moi, où est la gare?" },
            { french: "maison", hebrew: "בית", example: "J'habite dans une grande maison à Paris." },
            { french: "chien", hebrew: "כלב", example: "Mon chien s'appelle Max et il est très gentil." },
            { french: "chat", hebrew: "חתול", example: "Le chat dort sur le canapé." },
            { french: "pomme", hebrew: "תפוח", example: "Je mange une pomme rouge tous les matins." },
            { french: "eau", hebrew: "מים", example: "J'ai soif, je vais boire un verre d'eau." },
            { french: "pain", hebrew: "לחם", example: "Le boulanger vend du pain frais tous les jours." },
            { french: "fromage", hebrew: "גבינה", example: "J'adore le fromage français, surtout le brie." },
            { french: "bonne nuit", hebrew: "לילה טוב", example: "Bonne nuit, fais de beaux rêves!" },
            { french: "comment", hebrew: "איך", example: "Comment allez-vous aujourd'hui?" },
            { french: "où", hebrew: "איפה", example: "Où est la bibliothèque?" },
            { french: "qui", hebrew: "מי", example: "Qui est-ce qui vient ce soir?" },
            { french: "quoi", hebrew: "מה", example: "Qu'est-ce que vous voulez manger?" },
            { french: "pourquoi", hebrew: "למה", example: "Pourquoi êtes-vous en retard?" },
            { french: "parler", hebrew: "לדבר", example: "Je parle français depuis cinq ans." },
            { french: "aimer", hebrew: "לאהוב", example: "J'aime beaucoup le chocolat français." },
            { french: "manger", hebrew: "לאכול", example: "Nous allons manger au restaurant ce soir." },
            { french: "boire", hebrew: "לשתות", example: "Je veux boire un café après le déjeuner." },
            { french: "aller", hebrew: "ללכת", example: "Je vais aller au cinéma demain." },
            { french: "venir", hebrew: "לבוא", example: "Mes amis vont venir me rendre visite." },
            { french: "voir", hebrew: "לראות", example: "Je veux voir le nouveau film français." },
            { french: "faire", hebrew: "לעשות", example: "Qu'est-ce que vous allez faire ce weekend?" },
            { french: "être", hebrew: "להיות", example: "Je suis heureux d'apprendre le français." },
            { french: "avoir", hebrew: "יש/להיות בעל", example: "J'ai deux chats et un chien." },
            { french: "savoir", hebrew: "לדעת", example: "Je sais parler plusieurs langues." },
            { french: "connaître", hebrew: "לדעת/להכיר", example: "Je connais bien cette ville, j'y habite depuis longtemps." },
            { french: "travail", hebrew: "עבודה", example: "Mon travail commence à huit heures du matin." },
            { french: "école", hebrew: "בית ספר", example: "Les enfants vont à l'école tous les jours." },
            { french: "famille", hebrew: "משפחה", example: "Ma famille habite à Lyon." },
            { french: "ami", hebrew: "חבר", example: "J'ai un bon ami qui parle français couramment." },
            { french: "livre", hebrew: "ספר", example: "Je lis un livre intéressant en ce moment." },
            { french: "voiture", hebrew: "מכונית", example: "Nous allons louer une voiture pour le voyage." },
            { french: "temps", hebrew: "זמן/מזג אוויר", example: "Quel temps fait-il aujourd'hui?" },
            { french: "jour", hebrew: "יום", example: "Bonne journée! À demain!" },
            { french: "nuit", hebrew: "לילה", example: "La nuit est belle avec toutes ces étoiles." },
            { french: "soleil", hebrew: "שמש", example: "Le soleil brille aujourd'hui." },
            { french: "pluie", hebrew: "גשם", example: "Il pleut beaucoup cette semaine." },
            { french: "rouge", hebrew: "אדום", example: "J'aime beaucoup la couleur rouge." },
            { french: "bleu", hebrew: "כחול", example: "Le ciel est bleu aujourd'hui." },
            { french: "vert", hebrew: "ירוק", example: "Les arbres sont verts au printemps." },
            { french: "un", hebrew: "אחד", example: "J'ai un chat et deux chiens." },
            { french: "deux", hebrew: "שניים", example: "Nous sommes deux amis dans cette classe." },
            { french: "trois", hebrew: "שלושה", example: "Il y a trois pommes sur la table." },
            { french: "grand", hebrew: "גדול", example: "Paris est une grande ville magnifique." },
            { french: "petit", hebrew: "קטן", example: "J'habite dans un petit appartement." },
        ];

        const startInput = document.getElementById("start");
        const endInput = document.getElementById("end");
        const patternInput = document.getElementById("pattern");
        const playButton = document.getElementById("playButton");
        const pauseButton = document.getElementById("pauseButton");
        const showButton = document.getElementById("showButton");
        const testButton = document.getElementById("testButton");
        const searchButton = document.getElementById("searchButton");
        const wordDisplay = document.getElementById("wordDisplay");
        const shuffleCheckbox = document.getElementById("shuffle");
        const speedControl = document.getElementById("speed");
        const speedValue = document.getElementById("speedValue");
        const volumeControl = document.getElementById("volume");
        const progressBar = document.getElementById("progress");

        // Event Listeners for controls
        speedControl.addEventListener("input", (e) => {
            speechRate = parseFloat(e.target.value);
            speedValue.textContent = speechRate + "x";
        });

        volumeControl.addEventListener("input", (e) => {
            volume = parseFloat(e.target.value);
        });

        // Keyboard shortcuts
        document.addEventListener("keydown", (e) => {
            switch(e.key) {
                case " ":
                    e.preventDefault();
                    isPlaying ? pause() : play();
                    break;
                case "ArrowLeft":
                    previousWord();
                    break;
                case "ArrowRight":
                    nextWord();
                    break;
                case "ArrowUp":
                    volumeControl.value = Math.min(1, parseFloat(volumeControl.value) + 0.1);
                    volume = volumeControl.value;
                    break;
                case "ArrowDown":
                    volumeControl.value = Math.max(0, parseFloat(volumeControl.value) - 0.1);
                    volume = volumeControl.value;
                    break;
            }
        });

        function updateProgress() {
            const total = vocabulary.length;
            const progress = ((currentWordIndex + 1) / total) * 100;
            progressBar.style.width = progress + "%";
        }

        function showWord(word, index) {
            const cardHtml = `
                <div class="word-card">
                    <div class="word-id">ID: ${index}</div>
                    <div class="word-french">${word.french}</div>
                    <div class="word-hebrew">${word.hebrew}</div>
                    <div class="word-example">${word.example}</div>
                </div>
            `;
            wordDisplay.innerHTML = cardHtml;
        }

        function previousWord() {
            if (currentWordIndex > 0) {
                currentWordIndex--;
                let words = getSelectedWords();
            // Shuffle words for first cycle
            if (shuffleCheckbox.checked) {
                words = words.sort(() => Math.random() - 0.5);
            }
                const startIndex = parseInt(startInput.value, 10);
                showWord(words[currentWordIndex], startIndex + currentWordIndex);
                updateProgress();
            }
        }

        function nextWord() {
            let words = getSelectedWords();
            // Shuffle words for first cycle
            if (shuffleCheckbox.checked) {
                words = words.sort(() => Math.random() - 0.5);
            }
            if (currentWordIndex < words.length - 1) {
                currentWordIndex++;
                const startIndex = parseInt(startInput.value, 10);
                showWord(words[currentWordIndex], startIndex + currentWordIndex);
                updateProgress();
            }
        }

        function addIdsToWords(words) {
            return words.map((word, index) => ({
                id: index,
                french: word.french,
                hebrew: word.hebrew,
                example: word.example
            }));
        }

        function getSelectedWords() {
            const startIndex = parseInt(startInput.value, 10);
            const endIndex = parseInt(endInput.value, 10);
            let words = vocabulary.slice(startIndex, endIndex + 1);
            words = addIdsToWords(words);
            return words;
        }

        async function say(word, lang = 'en') {
            return new Promise((resolve, reject) => {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = lang;
                utterance.rate = speechRate;
                utterance.volume = volume;

                utterance.onend = () => resolve();
                utterance.onerror = reject;

                speechSynthesis.speak(utterance);
            });
        }

        function pause() {
            isPlaying = false;
            playbackId = null; // Reset playback session
            speechSynthesis.cancel();
            playButton.textContent = "Resume";
            
            // Save current state
            saveProgress();
        }

        let playbackId = null; // Track current playback session

        async function play() {
            // Stop any existing playback
            pause();
            
            // Generate new playback ID
            playbackId = Date.now();
            const currentPlaybackId = playbackId;

            isPlaying = true;
            playButton.textContent = "Pause";
            let words = getSelectedWords();
            // Shuffle words for first cycle
            if (shuffleCheckbox.checked) {
                words = words.sort(() => Math.random() - 0.5);
            }

            // Reset progress if parameters changed
            if (currentWordIndex >= words.length) {
                currentWordIndex = 0;
            }

            while (isPlaying && playbackId === currentPlaybackId) {
                for (let i = currentWordIndex; i < words.length; i++) {
                    // Check if this playback session is still current
                    if (playbackId !== currentPlaybackId || !isPlaying) {
                        break;
                    }

                    currentWordIndex = i;
                    updateProgress();
                    const startIndex = parseInt(startInput.value, 10);
                    showWord(words[i], startIndex + i);

                    const patternText = patternInput.value;
                    for (let j = 0; j < patternText.length; j++) {
                        // Check if this playback session is still current
                        if (playbackId !== currentPlaybackId || !isPlaying) {
                            break;
                        }

                        if (patternText[j] === 'f') {
                            await say(words[i].french, 'fr-FR');
                        } else if (patternText[j] === 's') {
                            await say(words[i].example, 'fr-FR');
                        } else if (patternText[j] === 'h') {
                            await say(words[i].hebrew, 'he-IL');
                        }
                    }
                }

                // Reset for next cycle if still playing
                if (playbackId === currentPlaybackId && isPlaying) {
                    await say('nouveau cycle', 'fr-FR');
                    currentWordIndex = 0;
                    // Shuffle words for new cycle
                    if (shuffleCheckbox.checked) {
                        words = words.sort(() => Math.random() - 0.5);
                    }
                    updateProgress();
                }
            }
        }

        function show() {
            let words = getSelectedWords();
            // Shuffle words for first cycle
            if (shuffleCheckbox.checked) {
                words = words.sort(() => Math.random() - 0.5);
            }
            const startIndex = parseInt(startInput.value, 10);
            wordDisplay.innerHTML = words.map((word, i) => `
                <div class="word-card">
                    <div class="word-id">ID: ${startIndex + i}</div>
                    <div class="word-french">${word.french}</div>
                    <div class="word-hebrew">${word.hebrew}</div>
                    <div class="word-example">${word.example}</div>
                </div>
            `).join('');
        }

        async function test() {
            let words = getSelectedWords();
            let round = 1;

            while (words.length > 0) {
                if (shuffleCheckbox.checked) {
                    words = words.sort(() => Math.random() - 0.5);
                }
                
                const nextLevel = [];
                for (let i = 0; i < words.length; i++) {
                    currentWordIndex = i;
                    updateProgress();
                    const startIndex = parseInt(startInput.value, 10);
                    showWord(words[i], startIndex + i);
                    await say(words[i].french, 'fr-FR');
                    
                    const response = await new Promise(resolve => {
                        const responseDiv = document.createElement('div');
                        responseDiv.className = 'buttons';
                        responseDiv.innerHTML = `
                            <button onclick="this.parentElement.dataset.response='y'">I Know This</button>
                            <button onclick="this.parentElement.dataset.response='n'">Don't Know</button>
                        `;
                        wordDisplay.appendChild(responseDiv);
                        
                        const checkResponse = setInterval(() => {
                            if (responseDiv.dataset.response) {
                                clearInterval(checkResponse);
                                const response = responseDiv.dataset.response;
                                responseDiv.remove();
                                resolve(response);
                            }
                        }, 100);
                    });

                    if (response === 'n') {
                        nextLevel.push(words[i]);
                    }
                }

                words = nextLevel;
                round++;
                
                if (words.length > 0) {
                    await new Promise(resolve => {
                        wordDisplay.innerHTML = `
                            <div class="word-card">
                                <h2>Round ${round}</h2>
                                <p>${words.length} words remaining</p>
                                <button id="nextRoundBtn">Continue to Next Round</button>
                            </div>
                        `;

                        const btn = document.getElementById('nextRoundBtn');
                        btn.addEventListener('click', () => {
                            wordDisplay.querySelector('.word-card').remove();
                            resolve();
                        });
                    });
                }
            }

            wordDisplay.innerHTML = `
                <div class="word-card">
                    <h2>Congratulations!</h2>
                    <p>You've learned all the words in this set.</p>
                </div>
            `;
        }

        // Save progress to localStorage
        function saveProgress() {
            localStorage.setItem('vocabProgress', JSON.stringify({
                currentIndex: currentWordIndex,
                startIndex: startInput.value,
                endIndex: endInput.value,
                pattern: patternInput.value,
                shuffle: shuffleCheckbox.checked,
                speed: speedControl.value,
                volume: volumeControl.value
            }));
        }

        // Load progress from localStorage
        function loadProgress() {
            const progress = JSON.parse(localStorage.getItem('vocabProgress'));
            if (progress) {
                currentWordIndex = progress.currentIndex;
                startInput.value = progress.startIndex;
                endInput.value = progress.endIndex;
                patternInput.value = progress.pattern;
                shuffleCheckbox.checked = progress.shuffle;
                speedControl.value = progress.speed || 1;
                volumeControl.value = progress.volume || 1;
                updateProgress();
            }
        }

        // Search functionality
        searchButton.addEventListener("click", () => {
            const searchTerm = prompt("Enter search term:");
            if (searchTerm) {
                const results = vocabulary.map((word, index) => ({ word, index }))
                    .filter(({ word }) => 
                        word.french.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        word.hebrew.includes(searchTerm) ||
                        word.example.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                
                wordDisplay.innerHTML = results.length > 0 ? 
                    results.map(({ word, index }) => `
                        <div class="word-card">
                            <div class="word-id">ID: ${index}</div>
                            <div class="word-french">${word.french}</div>
                            <div class="word-hebrew">${word.hebrew}</div>
                            <div class="word-example">${word.example}</div>
                        </div>
                    `).join('') :
                    '<div class="word-card">No results found</div>';
            }
        });

        // Initialize event listeners
        playButton.addEventListener("click", play);
        pauseButton.addEventListener("click", pause);
        showButton.addEventListener("click", show);
        testButton.addEventListener("click", test);

        // Stop playback when parameters change
        [startInput, endInput, patternInput, shuffleCheckbox].forEach(element => {
            element.addEventListener("change", () => {
                if (isPlaying) {
                    pause();
                }
            });
        });

        // Initialize
        loadProgress();
        window.addEventListener('beforeunload', saveProgress);


    </script>
</body>
</html>
